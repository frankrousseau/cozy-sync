// Generated by CoffeeScript 1.10.0
var DAVServer, americano, e, error, fs, path, publicPath;

fs = require('fs');

path = require('path');

americano = require('americano');

DAVServer = require('./davserver');

publicPath = __dirname + '/../client/public';

try {
  fs.lstatSync(publicPath);
} catch (error) {
  e = error;
  publicPath = __dirname + '/../../client/public';
}

module.exports = {
  common: {
    set: {
      views: path.join(__dirname, 'views')
    },
    use: [
      americano["static"](publicPath, {
        maxAge: 86400000
      }), americano.bodyParser({
        keepExtensions: true
      }), americano.logger('dev'), function(req, res, next) {
        if (req.url.indexOf('/public') !== 0) {
          return next(null);
        }
        req.url = req.url.replace('/public', '/public/sync');
        return DAVServer.exec(req, res);
      }
    ],
    useAfter: [
      americano.errorHandler({
        dumpExceptions: true,
        showStack: true
      })
    ],
    engine: {
      js: function(path, locals, callback) {
        return callback(null, require(path)(locals));
      }
    }
  },
  development: [americano.logger('dev')],
  production: [americano.logger('short')],
  plugins: ['cozydb']
};
